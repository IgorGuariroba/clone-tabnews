#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Pega os arquivos staged que foram modificados, adicionados ou renomeados
staged_files=$(git diff --cached --name-only --diff-filter=ACM)

# Se não houver arquivos staged, não faz nada
if [ -z "$staged_files" ]; then
  exit 0
fi

# Filtra apenas arquivos que o prettier suporta
prettier_files=$(echo "$staged_files" | grep -E '\.(js|jsx|ts|tsx|json|css|scss|md|yml|yaml|html)$' || true)

# Se não houver arquivos para verificar, não faz nada
if [ -z "$prettier_files" ]; then
  exit 0
fi

# Roda prettier --check nos arquivos alterados
echo "Verificando formatação com Prettier..."
echo "$prettier_files" | xargs npx prettier --check

# Se prettier encontrar problemas, o commit será bloqueado
if [ $? -ne 0 ]; then
  echo ""
  echo "❌ Prettier encontrou problemas de formatação!"
  echo "Execute 'npm run lint:prettier:fix' para corrigir automaticamente."
  exit 1
fi

echo "✅ Todos os arquivos passaram na verificação do Prettier!"

